Docker Notes

Useful web pages

https://www.linux.com/tutorials/docker-volumes-and-networks-compose/
https://mukulrathi.com/docker-postgres-flask/
https://wsvincent.com/django-docker-postgresql/
https://www.tutorialspoint.com/flask/flask_sqlalchemy.htm
https://www.paepper.com/blog/posts/pytorch-gpu-inference-with-docker/
https://github.com/NVIDIA/nvidia-docker
https://stackoverflow.com/questions/39773125/use-flask-sqlalchemy-models-in-jupyter-notebook

Docker Hubs
https://hub.docker.com/_/python

Dcoker Commands

--build server
docker build -t api_server .


-- run with gpu support
-- this approach is needed until docker compose will support gpu pass through
docker run -p 8008:8008 --gpus all api_server

then run
docker-compose up

-- run interactive?
docker exec -it api_server bash

docker exec -it temp_postgres bash

#log into app / flask server (once docker compose is up)

docker exec -it tvsentiment_endpoint_1 bash

flask shell

from db_models import db

#log into database
docker exec -it tvsentiment_database_1 bash

psql -U user_pg -h localhost -d tv_sentiment

docker exec -it tvsentiment_database_1 bash

Flask Notes

export FLASK_APP=api_server.py

flask run


POST Test

curl --header "Content-Type: application/json" \
  --request POST \
  --data '{"text":"mindhunter is awesome"}' \
  http://localhost:8008/api/v1/predict


Docker Volumes...

-- creating a named volume
docker volume create postgres_db_data
--mountpoint
/var/lib/docker/volumes/postgres_db_data/_data

in docker compose I use the above path to the volume, in docker run I can use the name but in both cases they now point to the same data thank fuck!

-- this creates a new container but uses the persisted data and maps the ports to the host so I can connect via jupyter
docker run --env-file database.env --volume postgres_db_data:/var/lib/postgresql/data/ -p 5432:5432 --name temp_postgres postgres